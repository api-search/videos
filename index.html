---
layout: page
title: Search
---

<center>
<p class="uk-text-lead uk-text-center" style="font-size: 24px; margin-bottom: 10px;">{{ site.name }} {{ page.title }} Index</p>
<form class="row">
    <table align="center" style="width: 250px;">
        <tr>
            <td style="width: 350px;" align="right">
                <input type="text" class="form-control" id="api-search" style="width: 250px">
            </td>
            <td style="width: 50px;" align="center">
                <input type="text" class="form-control" id="api-limit" style="width: 50px" value="10">
            </td>                                
            <td style="width: 50px;">
                <button type="submit" class="btn btn-dark" onclick="search(); return false;">Search</button>
            </td>
        </tr>
    </table>
</form>
</center>
<table  class="table table-hover" id="search-results"></table>    
{% if site.search_local == true %}     
<script>     

    function pullNode(node_url){

        const options = {
                method: 'get',
                headers: {
                    "Accept": "application/json"
                }
            };	

        fetch(node_url,options)
            .then(function(response) {
                if (!response.ok) {
                    console.log('Error with Status Code: ' + response.status);
                    return;
                }
                response.json().then(function(search) {	

                    console.log(search.name);                                 
                        
                });
            })
            .catch(function(err) {
                console.log('Error: ' + err);
        }); 

        }

    function searchNode(node_url){

        const options = {
                method: 'get',
                headers: {
                    "Accept": "application/json"
                }
            };	

        fetch(node_url,options)
            .then(function(response) {
                if (!response.ok) {
                    console.log('Error with Status Code: ' + response.status);
                    return;
                }
                response.json().then(function(search) {	

                    console.log(search.name); 

                    for (let i = 0; i < search.includes.length; i++) {
                        console.log(search.includes[i].name + ' - ' + search.includes[i].url);
                        pullNode(search.includes[i].url);
                        }                    
                        
                });
            })
            .catch(function(err) {
                console.log('Error: ' + err);
        }); 

    }

    function search(){

        let query = 'api';

        if(document.getElementById('api-search').value != ''){                        
            query = document.getElementById('api-search').value;
        }

        let limit = document.getElementById('api-limit').value;
        if(limit == ''){ limit = 10; }

        // Search Local
        searchNode('api/index.json');

        {% assign apis = site.data.apis %}
        {% for node in apis.network %}
            
        // Search Network
        searchNode('{{ node.url }}');

        {% endfor %}         
              
    }
</script>
{% else %} 
<script>      
    function search(){

        let query = 'api';
        if(document.getElementById('api-search').value != ''){                        
            query = document.getElementById('api-search').value;
        }

        let limit = document.getElementById('api-limit').value;
        if(limit == ''){ limit = 10; }

        const options = {
                method: 'get',
                headers: {
                    "Accept": "application/json"
                }
            };	

        fetch('{{ site.search_url }}?search=' + query + '&limit=' + limit + '&page=0',options)
            .then(function(response) {
                if (!response.ok) {
                    console.log('Error with Status Code: ' + response.status);
                    return;
                }
                response.json().then(function(search) {	
                
                    if(prime == 0){
                        
                        let rows = '';
                        if(search.data.length > 0){
                            for (let i = 1; i < search.data.length; i++) {
                                rows += '<tr>';
                                rows += '<th scope="row"></th>';
                                rows += '<td style="text-align:left; vertical-align: middle;">' + search.data[i].name + '</td>';
                                rows += '<td style="width: 50px;"><a href="' + search.data[i].humanURL + '" target="_blank"><button type="button" class="btn btn-outline-primary">API</button></a></td>';
                                rows += '<td style="width: 50px;"><a href="https://apis.io/' + search.data[i].slug + '" target="_blank"><button type="button" class="btn btn-outline-success">INFO</button></a></td>';
                                rows += '</tr>';
                            }
                            document.getElementById('search-results').innerHTML = rows;
                        }
                        else{
                            document.getElementById('search-results').innerHTML = '<tr><th scope="row"></th><td style="padding: 25px;">No Results</td></tr>';
                        }
                        
                        
                    }
                });
            })
            .catch(function(err) {
                console.log('Error: ' + err);
        });               
    }
</script>
{% endif %}                    
